function style_html(a,b){function c(){return this.pos=0,this.token="",this.current_mode="CONTENT",this.tags={parent:"parent1",parentcount:1,parent1:""},this.tag_type="",this.token_text=this.last_token=this.last_text=this.token_type="",this.Utils={whitespace:"\n\r	 ".split(""),single_token:"br,input,link,meta,!doctype,basefont,base,area,hr,wbr,param,img,isindex,?xml,embed,?php,?,?=".split(","),extra_liners:"head,body,/html".split(","),in_array:function(a,b){for(var c=0;c<b.length;c++)if(a===b[c])return!0;return!1}},this.get_content=function(){for(var a="",b=[],c=!1;"<"!==this.input.charAt(this.pos);){if(this.pos>=this.input.length)return b.length?b.join(""):["","TK_EOF"];if(a=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(a,this.Utils.whitespace))b.length&&(c=!0),this.line_char_count--;else{if(c){if(this.line_char_count>=this.max_char){b.push("\n");for(var d=0;d<this.indent_level;d++)b.push(this.indent_string);this.line_char_count=0}else b.push(" "),this.line_char_count++;c=!1}b.push(a)}}return b.length?b.join(""):""},this.get_contents_to=function(a){if(this.pos==this.input.length)return["","TK_EOF"];var b="",c=new RegExp("</"+a+"\\s*>","igm");c.lastIndex=this.pos;var d=c.exec(this.input),e=d?d.index:this.input.length;return this.pos<e&&(b=this.input.substring(this.pos,e),this.pos=e),b},this.record_tag=function(a){this.tags[a+"count"]?(this.tags[a+"count"]++,this.tags[a+this.tags[a+"count"]]=this.indent_level):(this.tags[a+"count"]=1,this.tags[a+this.tags[a+"count"]]=this.indent_level),this.tags[a+this.tags[a+"count"]+"parent"]=this.tags.parent,this.tags.parent=a+this.tags[a+"count"]},this.retrieve_tag=function(a){if(this.tags[a+"count"]){for(var b=this.tags.parent;b&&a+this.tags[a+"count"]!==b;)b=this.tags[b+"parent"];b&&(this.indent_level=this.tags[a+this.tags[a+"count"]],this.tags.parent=this.tags[b+"parent"]),delete this.tags[a+this.tags[a+"count"]+"parent"],delete this.tags[a+this.tags[a+"count"]],1==this.tags[a+"count"]?delete this.tags[a+"count"]:this.tags[a+"count"]--}},this.get_tag=function(){var a,b,c="",d=[],e=!1;do{if(this.pos>=this.input.length)return d.length?d.join(""):["","TK_EOF"];c=this.input.charAt(this.pos),this.pos++,this.line_char_count++,this.Utils.in_array(c,this.Utils.whitespace)?(e=!0,this.line_char_count--):(("'"===c||'"'===c)&&(d[1]&&"!"===d[1]||(c+=this.get_unformatted(c),e=!0)),"="===c&&(e=!1),d.length&&"="!==d[d.length-1]&&">"!==c&&e&&(this.line_char_count>=this.max_char?(this.print_newline(!1,d),this.line_char_count=0):(d.push(" "),this.line_char_count++),e=!1),"<"===c&&(a=this.pos-1),d.push(c))}while(">"!==c);var f,g=d.join("");f=g.indexOf(-1!=g.indexOf(" ")?" ":">");var h=g.substring(1,f).toLowerCase();if("/"===g.charAt(g.length-2)||this.Utils.in_array(h,this.Utils.single_token))this.tag_type="SINGLE";else if("script"===h)this.record_tag(h),this.tag_type="SCRIPT";else if("style"===h)this.record_tag(h),this.tag_type="STYLE";else if(this.Utils.in_array(h,i)){var j=this.get_unformatted("</"+h+">",g);d.push(j),a>0&&this.Utils.in_array(this.input.charAt(a-1),this.Utils.whitespace)&&d.splice(0,0,this.input.charAt(a-1)),b=this.pos-1,this.Utils.in_array(this.input.charAt(b+1),this.Utils.whitespace)&&d.push(this.input.charAt(b+1)),this.tag_type="SINGLE"}else if("!"===h.charAt(0))if(-1!=h.indexOf("[if")){if(-1!=g.indexOf("!IE")){var j=this.get_unformatted("-->",g);d.push(j)}this.tag_type="START"}else if(-1!=h.indexOf("[endif"))this.tag_type="END",this.unindent();else if(-1!=h.indexOf("[cdata[")){var j=this.get_unformatted("]]>",g);d.push(j),this.tag_type="SINGLE"}else{var j=this.get_unformatted("-->",g);d.push(j),this.tag_type="SINGLE"}else"/"===h.charAt(0)?(this.retrieve_tag(h.substring(1)),this.tag_type="END"):(this.record_tag(h),this.tag_type="START"),this.Utils.in_array(h,this.Utils.extra_liners)&&this.print_newline(!0,this.output);return d.join("")},this.get_unformatted=function(a,b){if(b&&-1!=b.toLowerCase().indexOf(a))return"";var c="",d="",e=!0;do{if(this.pos>=this.input.length)return d;if(c=this.input.charAt(this.pos),this.pos++,this.Utils.in_array(c,this.Utils.whitespace)){if(!e){this.line_char_count--;continue}if("\n"===c||"\r"===c){d+="\n",this.line_char_count=0;continue}}d+=c,this.line_char_count++,e=!0}while(-1==d.toLowerCase().indexOf(a));return d},this.get_token=function(){var a;if("TK_TAG_SCRIPT"===this.last_token||"TK_TAG_STYLE"===this.last_token){var b=this.last_token.substr(7);return a=this.get_contents_to(b),"string"!=typeof a?a:[a,"TK_"+b]}if("CONTENT"===this.current_mode)return a=this.get_content(),"string"!=typeof a?a:[a,"TK_CONTENT"];if("TAG"===this.current_mode){if(a=this.get_tag(),"string"!=typeof a)return a;var c="TK_TAG_"+this.tag_type;return[a,c]}},this.get_full_indent=function(a){return a=this.indent_level+a||0,1>a?"":Array(a+1).join(this.indent_string)},this.printer=function(a,b,c,d,e){this.input=a||"",this.output=[],this.indent_character=b,this.indent_string="",this.indent_size=c,this.brace_style=e,this.indent_level=0,this.max_char=d,this.line_char_count=0;for(var f=0;f<this.indent_size;f++)this.indent_string+=this.indent_character;this.print_newline=function(a,b){if(this.line_char_count=0,b&&b.length){if(!a)for(;this.Utils.in_array(b[b.length-1],this.Utils.whitespace);)b.pop();b.push("\n");for(var c=0;c<this.indent_level;c++)b.push(this.indent_string)}},this.print_token=function(a){this.output.push(a)},this.indent=function(){this.indent_level++},this.unindent=function(){this.indent_level>0&&this.indent_level--}},this}var d,e,f,g,h,i;for(b=b||{},e=b.indent_size||4,f=b.indent_char||" ",h=b.brace_style||"collapse",g=0==b.max_char?1/0:b.max_char||70,i=b.unformatted||["a","span","bdo","em","strong","dfn","code","samp","kbd","var","cite","abbr","acronym","q","sub","sup","tt","i","b","big","small","u","s","strike","font","ins","del","pre","address","dt","h1","h2","h3","h4","h5","h6"],d=new c,d.printer(a,f,e,g,h);;){var j=d.get_token();if(d.token_text=j[0],d.token_type=j[1],"TK_EOF"===d.token_type)break;switch(d.token_type){case"TK_TAG_START":d.print_newline(!1,d.output),d.print_token(d.token_text),d.indent(),d.current_mode="CONTENT";break;case"TK_TAG_STYLE":case"TK_TAG_SCRIPT":d.print_newline(!1,d.output),d.print_token(d.token_text),d.current_mode="CONTENT";break;case"TK_TAG_END":if("TK_CONTENT"===d.last_token&&""===d.last_text){var k=d.token_text.match(/\w+/)[0],l=d.output[d.output.length-1].match(/<\s*(\w+)/);(null===l||l[1]!==k)&&d.print_newline(!0,d.output)}d.print_token(d.token_text),d.current_mode="CONTENT";break;case"TK_TAG_SINGLE":var m=d.token_text.match(/^\s*<([a-z]+)/i);m&&d.Utils.in_array(m[1],i)||d.print_newline(!1,d.output),d.print_token(d.token_text),d.current_mode="CONTENT";break;case"TK_CONTENT":""!==d.token_text&&d.print_token(d.token_text),d.current_mode="TAG";break;case"TK_STYLE":case"TK_SCRIPT":if(""!==d.token_text){d.output.push("\n");var n=d.token_text;if("TK_SCRIPT"==d.token_type)var o="function"==typeof js_beautify&&js_beautify;else if("TK_STYLE"==d.token_type)var o="function"==typeof css_beautify&&css_beautify;if("keep"==b.indent_scripts)var p=0;else if("separate"==b.indent_scripts)var p=-d.indent_level;else var p=1;var q=d.get_full_indent(p);if(o)n=o(n.replace(/^\s*/,q),b);else{var r=n.match(/^\s*/)[0],s=r.match(/[^\n\r]*$/)[0].split(d.indent_string).length-1,t=d.get_full_indent(p-s);n=n.replace(/^\s*/,q).replace(/\r\n|\r|\n/g,"\n"+t).replace(/\s*$/,"")}n&&(d.print_token(n),d.print_newline(!0,d.output))}d.current_mode="TAG"}d.last_token=d.token_type,d.last_text=d.token_text}return d.output.join("")}CodeMirror.prototype.prettyPrint=function(a){var b={selectionOnly:!0,indent_size:2,brace_style:"expand"};$.extend(b,a);var c,d=b.selectionOnly;if(c=d?this.getSelection():this.getValue(),"undefined "!=typeof c){var e=style_html(c,b);d?this.replaceSelection(e,c):this.setValue(e)}};